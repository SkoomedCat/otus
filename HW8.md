# MVCC, vacuum и autovacuum

#### Запустить `pgbench -c8 -P 6 -T 60 -U postgres postgres`. Применить параметры настройки PostgreSQL из прикрепленного к материалам занятия файла. Протестировать заново
* При повторном тесте сильной разницы между двумя конфигурациями не нашел `tps` вырос на 5, но при увеличении `shared_buffers` до 1.5 Гб прирост `tps` на 40
#### Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1 млн строк. Посмотреть размер файла с таблицей
    CREATE TABLE student(id serial, fio char(100));
    INSERT INTO student(fio) SELECT 'noname' FROM generate_series(1,1000000);
`SELECT pg_size_pretty(pg_total_relation_size('student'));` показал вес таблицы 135 MB
####  5 раз обновить все строчки и добавить к каждой строчке любой символ
`update student set fio = 'name';`

`update student set fio = fio || '1';`
* Размер таблички увеличился до 539 MB автовакум отрабатывает после каждого апдейта
  
#### Отключить Автовакуум на конкретной таблице. 10 раз обновить все строчки и добавить к каждой строчке любой символ
* Размер таблички вырос до 1617 MB, из-за того что автовакум отключен место на диске не перезаписывается а просто заполняется мертвыми кортежами
####  *Написать анонимную процедуру, в которой в цикле 10 раз обновятся все строчки в искомой таблице. Не забыть вывести номер шага цикла.
    do $$
    begin
      for count in 1..10 loop
    update student set fio = 'fname';
    raise notice 'Шаг обновления номер %', count;
    end loop;
    end; $$
    ;
